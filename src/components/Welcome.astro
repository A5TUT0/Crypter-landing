---
import Layout from "../layouts/Layout.astro";
import {
  Download,
  Smartphone,
  Shield,
  Fingerprint,
  WifiOff,
  KeyRound,
  Database,
  MailWarning,
  ChevronDown,
  Lock,
  DollarSign,
} from "lucide-astro";

const version = "v1.0.0";
const downloadUrl = "https://download.luan.world/app-release.apk"; // file in /public
---

<Layout
  title="Crypter — Offline, secure password manager"
  description="100% offline password manager with AES-256 local encryption, biometrics, and breach checks."
>
  <!-- Top bar / Navbar -->
  <header
    class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-[#1a1d24]/60 bg-[#12141a]/80 border-b border-white/10"
  >
    <nav
      class="mx-auto max-w-6xl px-4 sm:px-6 flex items-center justify-between h-16"
    >
      <a href="#" class="flex items-center gap-3">
        <img
          src="/icon.png"
          alt="Crypter"
          class="h-8 w-8 rounded-md ring-1 ring-white/10 shadow"
        />
        <span class="text-base font-semibold tracking-tight">Crypter</span>
      </a>

      <a
        href={downloadUrl}
        download
        class="hidden sm:inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-[#df9f6a] to-[#c97e49] px-4 py-2 text-sm font-semibold text-black hover:text-black/90 shadow-lg shadow-[#df9f6a]/20 hover:opacity-95 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#df9f6a]"
        aria-label="Download Crypter for Android"
      >
        <Download width="20" height="20" />
        Download for Android · {version}
      </a>
    </nav>
  </header>

  <!-- Hero -->
  <section class="relative">
    <div class="mx-auto max-w-6xl px-4 sm:px-6 pt-10 sm:pt-14 pb-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
        <!-- Copy -->
        <div class="text-center lg:text-left">
          <h1
            class="text-4xl sm:text-5xl font-extrabold tracking-tight leading-tight"
          >
            Your passwords, <span
              class="bg-gradient-to-r from-[#df9f6a] to-[#c97e49] bg-clip-text text-transparent"
              >yours only</span
            >.
          </h1>
          <p class="mt-4 text-slate-300 text-base sm:text-lg">
            Crypter stores your credentials <strong>locally encrypted</strong> (AES-256
            + Keystore/Keychain), with <strong>biometrics</strong> and leak verification.
            100% offline. No cloud. No subscriptions.
          </p>

          <div
            class="mt-6 flex flex-col sm:flex-row gap-3 sm:justify-center lg:justify-start"
          >
            <a
              href={downloadUrl}
              download
              class="inline-flex items-center justify-center gap-2 rounded-xl bg-[#df9f6a] px-5 py-3 text-base font-semibold text-black shadow-lg shadow-[#df9f6a]/25 hover:opacity-95 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#df9f6a]"
            >
              <Smartphone width="22" height="22" />
              Download for Android ({version})
            </a>

            <a
              href="#features"
              class="inline-flex items-center justify-center gap-2 rounded-xl border border-white/10 px-5 py-3 text-base font-medium text-slate-100/90 hover:bg-white/5 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#df9f6a]"
            >
              <Shield width="22" height="22" />
              See security
            </a>
          </div>

          <!-- Badges -->
          <div
            class="mt-6 flex flex-wrap items-center justify-center lg:justify-start gap-2"
          >
            <span
              class="inline-flex items-center gap-2 rounded-full bg-[#df9f6a]/15 px-3 py-1 text-xs font-medium text-[#df9f6a] ring-1 ring-[#df9f6a]/30"
            >
              <Lock width="16" height="16" /> AES-256
            </span>
            <span
              class="inline-flex items-center gap-2 rounded-full bg-[#df9f6a]/15 px-3 py-1 text-xs font-medium text-[#df9f6a] ring-1 ring-[#df9f6a]/30"
            >
              <Fingerprint width="16" height="16" /> Biometrics
            </span>
            <span
              class="inline-flex items-center gap-2 rounded-full bg-[#df9f6a]/15 px-3 py-1 text-xs font-medium text-[#df9f6a] ring-1 ring-[#df9f6a]/30"
            >
              <WifiOff width="16" height="16" /> 100% offline
            </span>
            <span
              class="inline-flex items-center gap-2 rounded-full bg-[#df9f6a]/15 px-3 py-1 text-xs font-medium text-[#df9f6a] ring-1 ring-[#df9f6a]/30"
            >
              <DollarSign width="16" height="16" /> Free
            </span>
          </div>

          <p class="mt-4 text-xs text-slate-400">
            * The file is an <strong>.aab</strong> (Android App Bundle). If you need
            an <strong>.apk</strong>, use a compatible installer or convert it
            first.
          </p>
        </div>

        <!-- Visual: device mockup image -->
        <div class="relative">
          <div class="mx-auto max-w-xs sm:max-w-sm lg:max-w-md">
            <img
              src="/mockup.png"
              alt="Crypter app mockup on Android phone"
              class="w-full rounded-3xl ring-1 ring-white/10 shadow-2xl"
              loading="eager"
              decoding="async"
            />
          </div>
          <!-- Brand glow -->
          <div
            class="pointer-events-none absolute -inset-8 -z-10 blur-3xl opacity-40 bg-[radial-gradient(60%_60%_at_70%_30%,rgba(223,159,106,.35),transparent)]"
          >
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section id="features" class="mx-auto max-w-6xl px-4 sm:px-6 py-10 sm:py-14">
    <h2 class="text-2xl sm:text-3xl font-bold tracking-tight">
      Security & key features
    </h2>
    <p class="mt-2 text-slate-300">Everything you need — no cloud required.</p>

    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <article class="rounded-2xl bg-white/5 p-5 ring-1 ring-white/10">
        <div class="flex items-start gap-3">
          <div class="rounded-lg bg-[#df9f6a]/15 p-2 ring-1 ring-[#df9f6a]/30">
            <Shield width="22" height="22" />
          </div>
          <div>
            <h3 class="font-semibold">Strong local encryption</h3>
            <p class="mt-1 text-sm text-slate-300">
              AES-256 + Android Keystore / iOS Keychain. Keys never leave your
              device.
            </p>
          </div>
        </div>
      </article>

      <article class="rounded-2xl bg-white/5 p-5 ring-1 ring-white/10">
        <div class="flex items-start gap-3">
          <div class="rounded-lg bg-[#df9f6a]/15 p-2 ring-1 ring-[#df9f6a]/30">
            <Fingerprint width="22" height="22" />
          </div>
          <div>
            <h3 class="font-semibold">Biometric unlock</h3>
            <p class="mt-1 text-sm text-slate-300">
              Use fingerprint or face authentication when available.
            </p>
          </div>
        </div>
      </article>

      <article class="rounded-2xl bg-white/5 p-5 ring-1 ring-white/10">
        <div class="flex items-start gap-3">
          <div class="rounded-lg bg-[#df9f6a]/15 p-2 ring-1 ring-[#df9f6a]/30">
            <Database width="22" height="22" />
          </div>
          <div>
            <h3 class="font-semibold">Password leak check</h3>
            <p class="mt-1 text-sm text-slate-300">
              Query Pwned Passwords to see if a password was compromised.
            </p>
          </div>
        </div>
      </article>

      <article class="rounded-2xl bg-white/5 p-5 ring-1 ring-white/10">
        <div class="flex items-start gap-3">
          <div class="rounded-lg bg-[#df9f6a]/15 p-2 ring-1 ring-[#df9f6a]/30">
            <KeyRound width="22" height="22" />
          </div>
          <div>
            <h3 class="font-semibold">Random generator</h3>
            <p class="mt-1 text-sm text-slate-300">
              Instantly create robust, unique passwords.
            </p>
          </div>
        </div>
      </article>

      <article class="rounded-2xl bg-white/5 p-5 ring-1 ring-white/10">
        <div class="flex items-start gap-3">
          <div class="rounded-lg bg-[#df9f6a]/15 p-2 ring-1 ring-[#df9f6a]/30">
            <MailWarning width="22" height="22" />
          </div>
          <div>
            <h3 class="font-semibold">Email breach checks</h3>
            <p class="mt-1 text-sm text-slate-300">
              Verify if your email appears in public data breaches.
            </p>
          </div>
        </div>
      </article>

      <article class="rounded-2xl bg-white/5 p-5 ring-1 ring-white/10">
        <div class="flex items-start gap-3">
          <div class="rounded-lg bg-[#df9f6a]/15 p-2 ring-1 ring-[#df9f6a]/30">
            <WifiOff width="22" height="22" />
          </div>
          <div>
            <h3 class="font-semibold">100% offline & free</h3>
            <p class="mt-1 text-sm text-slate-300">
              No accounts, no servers, no fees.
            </p>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- APIs Used -->
  <section class="mx-auto max-w-6xl px-4 sm:px-6 py-8">
    <div class="rounded-2xl bg-white/5 p-6 ring-1 ring-white/10">
      <h2 class="text-xl sm:text-2xl font-bold tracking-tight">APIs we use</h2>
      <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="rounded-xl border border-white/10 p-4">
          <div class="flex items-center gap-2 text-sm font-semibold">
            <MailWarning width="18" height="18" class="text-[#df9f6a]" />
            XposedOrNot
          </div>
          <p class="mt-1 text-sm text-slate-300">
            Check if your email appears in public breaches.
          </p>
        </div>
        <div class="rounded-xl border border-white/10 p-4">
          <div class="flex items-center gap-2 text-sm font-semibold">
            <Database width="18" height="18" class="text-[#df9f6a]" />
            Pwned Passwords
          </div>
          <p class="mt-1 text-sm text-slate-300">
            Verify if a password has been compromised.
          </p>
        </div>
        <div class="rounded-xl border border-white/10 p-4">
          <div class="flex items-center gap-2 text-sm font-semibold">
            <KeyRound width="18" height="18" class="text-[#df9f6a]" />
            PasswordWolf
          </div>
          <p class="mt-1 text-sm text-slate-300">
            Generate strong random passwords.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Quick install -->
  <section id="install" class="mx-auto max-w-6xl px-4 sm:px-6 py-8">
    <h2 class="text-xl sm:text-2xl font-bold tracking-tight">
      Quick install (Android)
    </h2>
    <ol class="mt-4 space-y-3 text-sm text-slate-300">
      <li class="flex items-start gap-3">
        <span
          class="mt-1 inline-flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[#df9f6a]/15 ring-1 ring-[#df9f6a]/30"
          >1</span
        >
        Download <code class="rounded bg-white/10 px-1 py-0.5"
          >Crypter-{version}.aab</code
        >.
      </li>
      <li class="flex items-start gap-3">
        <span
          class="mt-1 inline-flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[#df9f6a]/15 ring-1 ring-[#df9f6a]/30"
          >2</span
        >
        If your device cannot install <code>.aab</code> directly, use a compatible
        installer or convert it to <code>.apk</code>.
      </li>
      <li class="flex items-start gap-3">
        <span
          class="mt-1 inline-flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-[#df9f6a]/15 ring-1 ring-[#df9f6a]/30"
          >3</span
        >
        Enable “Install unknown apps” only during installation, then disable it for
        safety.
      </li>
    </ol>
  </section>

  <!-- FAQ -->
  <section class="mx-auto max-w-6xl px-4 sm:px-6 py-10">
    <h2 class="text-xl sm:text-2xl font-bold tracking-tight">FAQ</h2>
    <div
      class="mt-4 divide-y divide-white/10 rounded-2xl border border-white/10"
    >
      <details class="group p-4 open:bg-white/5">
        <summary
          class="flex cursor-pointer list-none items-center justify-between text-sm font-semibold"
        >
          Does Crypter work offline?
          <ChevronDown
            width="20"
            height="20"
            class="transition group-open:rotate-180 text-[#df9f6a]"
          />
        </summary>
        <p class="mt-2 text-sm text-slate-300">
          Yes. All storage and encryption are local. Network is only used if you
          explicitly check for breaches.
        </p>
      </details>
      <details class="group p-4 open:bg-white/5">
        <summary
          class="flex cursor-pointer list-none items-center justify-between text-sm font-semibold"
        >
          What encryption do you use?
          <ChevronDown
            width="20"
            height="20"
            class="transition group-open:rotate-180 text-[#df9f6a]"
          />
        </summary>
        <p class="mt-2 text-sm text-slate-300">
          AES-256 with keys protected by Android Keystore / iOS Keychain and
          biometric authentication.
        </p>
      </details>
      <details class="group p-4 open:bg-white/5">
        <summary
          class="flex cursor-pointer list-none items-center justify-between text-sm font-semibold"
        >
          Is it free?
          <ChevronDown
            width="20"
            height="20"
            class="transition group-open:rotate-180 text-[#df9f6a]"
          />
        </summary>
        <p class="mt-2 text-sm text-slate-300">
          Yes. Crypter is 100% free and requires no account.
        </p>
      </details>
    </div>
  </section>

  <!-- Final CTA -->
  <section class="mx-auto max-w-6xl px-4 sm:px-6 pb-24 sm:pb-16">
    <div
      class="rounded-3xl bg-[linear-gradient(120deg,rgba(223,159,106,.12),rgba(223,159,106,.08))] ring-1 ring-white/10 p-6 sm:p-10 text-center"
    >
      <h3 class="text-2xl sm:text-3xl font-bold tracking-tight">
        Get started now
      </h3>
      <p class="mt-2 text-slate-300">
        Install Crypter and take control of your passwords — no third parties.
      </p>
      <a
        href={downloadUrl}
        download
        class="mt-6 inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-[#df9f6a] to-[#c97e49] px-6 py-3 text-base font-semibold text-black shadow-lg shadow-[#df9f6a]/20 hover:opacity-95 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#df9f6a]"
      >
        <Download width="22" height="22" />
        Download for Android ({version})
      </a>
    </div>
  </section>

  <!-- Sticky mobile download bar -->
  <div
    class="fixed inset-x-0 bottom-0 z-50 border-t border-white/10 bg-[#0f1218]/95 backdrop-blur sm:hidden"
  >
    <div class="mx-auto max-w-6xl px-4 py-3">
      <a
        href={downloadUrl}
        download
        class="flex w-full items-center justify-center gap-2 rounded-xl bg-[#df9f6a] px-5 py-3 text-sm font-semibold text-black shadow-lg shadow-[#df9f6a]/20"
      >
        <Smartphone width="18" height="18" />
        Download Crypter ({version})
      </a>
    </div>
  </div>

  <footer class="border-t border-white/10 py-8">
    <div
      class="mx-auto max-w-6xl px-4 sm:px-6 text-center text-xs text-slate-400"
    >
      © {new Date().getFullYear()} Crypter. Built with React Native. Private by
      design.
    </div>
  </footer>
  <script is:inline>
    (() => {
      const DOWNLOAD_URL = "{downloadUrl}";
      const ONE_HOUR = 60 * 60 * 1000;
      const STORAGE_KEY = "crypter_next_allowed";
      const COOKIE_NAME = "crypterNextAllowed";

      const fmt = (ms) => {
        const s = Math.max(0, Math.floor(ms / 1000));
        const h = Math.floor(s / 3600);
        const m = Math.floor((s % 3600) / 60);
        const sec = s % 60;
        const hh = h.toString();
        const mm = String(m).padStart(2, "0");
        const ss = String(sec).padStart(2, "0");
        return `${hh}:${mm}:${ss}`;
      };

      const setCookie = (name, value, expiresAtMs) => {
        const expires = new Date(expiresAtMs).toUTCString();
        // Requiere HTTPS para que "Secure" funcione.
        document.cookie = `${name}=${encodeURIComponent(
          value
        )}; expires=${expires}; path=/; SameSite=Lax; Secure`;
      };

      const getCookie = (name) => {
        const row = document.cookie
          .split("; ")
          .find((r) => r.startsWith(name + "="));
        return row ? decodeURIComponent(row.split("=")[1]) : null;
      };

      const readNextAllowed = () => {
        const ls = localStorage.getItem(STORAGE_KEY);
        const ck = getCookie(COOKIE_NAME);
        const lsNum = ls ? parseInt(ls, 10) : 0;
        const ckNum = ck ? parseInt(ck, 10) : 0;
        // Usa el valor más estricto (el más lejos en el tiempo).
        return Math.max(lsNum || 0, ckNum || 0);
      };

      const writeNextAllowed = (ts) => {
        localStorage.setItem(STORAGE_KEY, String(ts));
        setCookie(COOKIE_NAME, String(ts), ts); // la cookie expira justo cuando termina el bloqueo
      };

      const lockForHour = () => writeNextAllowed(Date.now() + ONE_HOUR);

      const anchors = Array.from(
        document.querySelectorAll(`a[download][href="${DOWNLOAD_URL}"]`)
      );

      function setLockedUI(locked, remainingMs = 0) {
        for (const a of anchors) {
          a.setAttribute("aria-disabled", locked ? "true" : "false");
          a.style.pointerEvents = locked ? "none" : "";
          a.style.opacity = locked ? "0.6" : "";
          a.title = locked
            ? `Solo 1 descarga por hora. Tiempo restante: ${fmt(remainingMs)}`
            : "Descargar";
        }
      }

      function tick() {
        const next = readNextAllowed();
        const now = Date.now();
        const locked = next > now;
        setLockedUI(locked, next - now);
        if (locked) {
          // Actualiza el tooltip/estado cada segundo mientras haya bloqueo
          setTimeout(tick, 1000);
        }
      }

      function onClick(e) {
        const next = readNextAllowed();
        const now = Date.now();
        if (next > now) {
          e.preventDefault();
          const remaining = next - now;
          alert(
            `Solo puedes descargar una vez por hora.\nVuelve en ${fmt(remaining)}.`
          );
          return false;
        } else {
          // Fijamos el bloqueo ANTES de navegar para que quede registrado
          lockForHour();
          // Permitimos la navegación/descarga
        }
      }

      // Adjunta interceptores
      for (const a of anchors) {
        // capture:true para adelantarnos a otros listeners
        a.addEventListener("click", onClick, { capture: true });
      }

      // Sincroniza entre pestañas/ventanas
      window.addEventListener("storage", (evt) => {
        if (evt.key === STORAGE_KEY) tick();
      });

      // Inicializa estado UI
      tick();
    })();
  </script>
</Layout>
